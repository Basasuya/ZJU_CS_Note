# 5.3 TCP协议

* tcp是一种面向连接的传输协议，是面向字节流，面向可靠连接，面向全双工的协议
* tcp报文段可以用来运载数据，建立连接，释放连接，应答

#### 1.tcp报文段

* 源端口号，目的端口字段
* 序号字段seq,确认字段ack(seq,ack的序号之间是没有联系的，ack的序号是对方服务器的编号)
* 数据偏移(首部长度)
* 保留字段，URG,ACk,PSH,RST,SYN,FIN

#### 2.tcp连接和释放

* SYN=1, ACK = 0,seq = x; SYN = 1, ACK = 1,ack = x+1, seq = y; SYN = 0,ACK = 1,ack =y+1, seq=x+1
* FIN=1, seq=u; ACK=1, seq=v, ack=u+1; FIN=1, ACK=1, seq=w, ack=u+1; ACK=1, seq=u+1, ack=w+1 

#### 3.tcp可靠传输

* 采用累积确认

> 一部分字段已经发送，没有确认，是不能立马发送的，而且还占发送窗口的空间

* 重传分两种，超时确认，冗余确认(接受发出信号，说明自己缺少什么

> 这样也会产生，接受方发出连续连两个两个确认报文，发送先接受了第二个确认报文，那么第二个报文缺失也是没有关系的

#### 4.流量控制，拥塞控制

* 流量控制是点到点的流量的控制
* 发送窗口 = min(接受窗口，拥塞窗口)

> 拥塞窗口是发送根据估算的网络拥塞程度进行设置的
>
> 所有窗口的大小是字节的大小

* 满开始，拥塞避免
* 快重传，快恢复




***

* tcp虽然是面向字节流的，但是不是每个字节都是需要确认的，而是一个报文段确认最后一个字节
* 释放阶段是不分客户和服务器的，都是可以提前提出断开连接的
* 对于拥塞控制的时间很容易错
* 滑动窗口的值太大可能导致拥挤